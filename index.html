<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Image Viewer</title>
</head>
<body>
    <h1>Live Image Feed</h1>
    <img id="liveImage" style="max-width: 100%; height: auto;" />
    <h2>Update Gain</h2>
    <input type="number" id="gainInput" placeholder="Set gain value">
    <button onclick="updateGain()">Send Gain</button>

    <script>
        // const ws = new WebSocket("ws://192.168.40.153:9002");
        const ws = new WebSocket("ws://localhost:9002");
        const liveImage = document.getElementById("liveImage");

        ws.onmessage = (event) => {
            console.log("In onmessage, event.data = " + event.data.slice(0, 30))
            liveImage.src = "data:image/jpeg;base64," + event.data; // Set base64-encoded image to img src
        };

        function updateGain() {
            const gainValue = document.getElementById("gainInput").value;
            if (gainValue) {
                ws.send(`SET_GAIN:${gainValue}`);
            }
        }

        ws.onopen = () => console.log("Connected to WebSocket server.");
        ws.onclose = () => console.log("Disconnected from WebSocket server.");
    </script>
</body>
</html>

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Image Stream</title>
</head>
<body>
    <h1>Image Stream</h1>
    <img id="image" alt="Streaming Image" style="width: 640px; height: 480px;">

    <h2>Settings</h2>
    <input id="gain" type="number" placeholder="Gain" step="0.1">
    <button id="send">Update Gain</button>

    <script>
        const ws = new WebSocket('ws://localhost:9002');
        const imageElement = document.getElementById('image');

        ws.onopen = () => {
            console.log('Connected to WebSocket server');
        };

        ws.onmessage = (event) => {
            if (typeof event.data === 'string') {
                console.log('Message received:', event.data);
            } else {
                const blob = new Blob([event.data], { type: 'image/jpeg' });
                const url = URL.createObjectURL(blob);
                imageElement.src = url;
            }
        };

        ws.onclose = () => {
            console.log('WebSocket connection closed');
        };

        document.getElementById('send').onclick = () => {
            const gain = document.getElementById('gain').value;
            if (gain) {
                ws.send(JSON.stringify({ gain: parseFloat(gain) }));
            }
        };
    </script>
</body>
</html> -->